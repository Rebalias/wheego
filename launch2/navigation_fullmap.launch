<?xml version="1.0"?>



<launch>

  <arg name="sim_nav" default="true"/>


  <param name="/use_sim_time" value="true" if="$(arg sim_nav)"/>

  <!--start map server node-->
  <node name="map_server" pkg="map_server" type="map_server" 
    args="$(find wheego)/cost_maps/testmap3.yaml">
    <remap from="map" to="map"/>
  </node>

  <include file="$(find wheego)/launch2/lidar_m.launch">
    <arg name="sim" value="$(arg sim_nav)"/>
  </include>

  <!--start rviz with sim time node-->
  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find wheego)/cost_maps/mapNav2.rviz" >

  </node>

  <!--set up scanner and set it to base frame-->
  <include file="$(find wheego)/launch/pc2scan.launch"/>

  <node pkg="tf" type="static_transform_publisher"
    name="base_to_laser_broadcaster"
    args="0 0 0 0 0 0 base_link velodyne 100"/>
  <node pkg="tf" type="static_transform_publisher"
    name="map_nav_map_bcast"
    args="0 0 0 0 0 0 map base_footprint 100"/>





   <include file="$(find wheego)/launch2/amcl2.launch"/>


  <!-- Run the costmap node -->
  <!--node name="costmap_node" pkg="costmap_2d" type="costmap_2d_node" >
    <rosparam file="$(find wheego)/maps/example_params.yaml" command="load" ns="costmap" />
  </node -->


  <!--start hector mapping to get odom info and nav_message/odom from scanmatcher-->
  <!--make sure to direct map somewhere else so it doesnt afftect map topic-->
  <include file="$(find wheego)/launch2/amcl_hector.launch"/>

  <node pkg="tf" type="static_transform_publisher" name="h_map" args="0 0 0 0 0 0 map mapcurrent 100"/>

  <include file="$(find wheego)/launch2/odomtransformer.launch"/>


   <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <remap from="odom" to="scanmatch_odom"/>
    <rosparam file="$(find wheego)/cost_maps/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
    <rosparam file="$(find wheego)/cost_maps/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find wheego)/cost_maps/local_costmap.yaml" command="load" />
    <rosparam file="$(find wheego)/cost_maps/global_cost_map.yaml" command="load" /> 
    <rosparam file="$(find wheego)/cost_maps/base_local_planner.yaml" command="load" />
   </node>

  <node name="path_follow" pkg="wheego" type="path_follow.py">
    <remap from="/sPath" to="/move_base/NavfnROS/plan"/>
  </node>

  <node name="can_bcast" pkg="wheego" type="canBcastSteer.py">
    <param name="pkgdir" value="$(find wheego)"/>
    <param name="sim" value="$(arg sim_nav)"/>
  </node>


</launch>
